<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المنظومة الوطنية للحماية المدنية</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary-red: #b30000;
            --dark-blue: #1a237e;
            --success-green: #2ecc71;
            --light-bg: #f8f9fa;
        }

        body { font-family: 'Cairo', sans-serif; background-color: var(--light-bg); margin: 0; padding: 0; }

        /* --- واجهة الدخول --- */
        #loginPage { display: flex; flex-direction: column; align-items: center; padding-top: 50px; }
        .header-section { text-align: center; margin-bottom: 30px; color: #333; }
        .header-section h4 { border-bottom: 3px solid var(--primary-red); width: fit-content; margin: 10px auto; padding-bottom: 5px; }
        .login-card { background: white; padding: 35px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 90%; max-width: 450px; border-top: 8px solid var(--primary-red); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 700; color: #555; }
        select, input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Cairo', sans-serif; box-sizing: border-box; }
        .btn-login { width: 100%; padding: 12px; background-color: var(--primary-red); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 10px; }
        .btn-add-unit { width: 100%; padding: 8px; background: none; color: var(--dark-blue); border: 2px dashed #cbd5e0; border-radius: 8px; cursor: pointer; margin-top: 15px; font-weight: 600; }

        /* --- لوحة التحكم --- */
        #dashboardPage { display: none; }
        .sidebar { width: 260px; background: var(--dark-blue); color: white; height: 100vh; position: fixed; }
        .sidebar h2 { text-align: center; font-size: 1rem; padding: 20px; border-bottom: 1px solid #3f51b5; }
        .sidebar-menu { list-style: none; padding: 0; }
        .sidebar-menu li { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #ffffff0d; transition: 0.3s; }
        .sidebar-menu li:hover, .sidebar-menu li.active { background: var(--primary-red); }
        .main-content { margin-right: 260px; padding: 30px; }
        
        /* --- الإحصائيات والأرشيف --- */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; border-bottom: 5px solid var(--primary-red); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .stat-card .value { font-size: 1.8rem; font-weight: 700; color: var(--dark-blue); }

        .archive-container { display: none; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .filter-bar { display: flex; gap: 15px; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; align-items: flex-end; flex-wrap: wrap; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table th { background: #f1f3f5; padding: 12px; border: 1px solid #dee2e6; color: var(--dark-blue); }
        table td { padding: 12px; text-align: center; border: 1px solid #dee2e6; }

        .btn-export { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: 600; margin-left: 5px; }
        .bg-excel { background: #1d6f42; }
        .bg-pdf { background: #e74c3c; }
        .bg-print { background: #34495e; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-box { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; }

        /* إخفاء spin buttons */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

        @media print {
            .sidebar, .filter-bar, .btn-export, .btn-login, .btn-add-unit { display: none !important; }
            .main-content { margin-right: 0 !important; width: 100% !important; padding: 0 !important; }
            .archive-container { display: block !important; box-shadow: none; border: none; }
        }
    </style>
</head>
<body>

    <div id="loginPage">
        <div class="header-section">
            <h2>الجمهورية الجزائرية الديمقراطية الشعبية</h2>
            <h3>وزارة الداخلية والجماعات المحلية والتهيئة العمرانية</h3>
            <h4>المديرية العامة للحماية المدنية</h4>
        </div>
        <div class="login-card">
            <h1 style="text-align: center; color: var(--dark-blue); font-size: 1.5rem;">بطاقة الدخول للنظام</h1>
            <div class="form-group">
                <label>الولاية / الهيئة</label>
                <select id="wilayaSelect" onchange="initUnits()">
                    <option value="">-- اختر من القائمة --</option>
                    <option value="المديرية العامة">المديرية العامة للحماية المدنية</option>
                </select>
            </div>
            <div class="form-group">
                <label>المصلحة / الوحدة</label>
                <select id="unitSelect"><option value="">-- اختر الوحدة --</option></select>
            </div>
            <div class="form-group">
                <label>كلمة المرور</label>
                <input type="password" id="passwordInput" placeholder="••••">
            </div>
            <button class="btn-login" onclick="handleLogin()">دخول للمنظومة</button>
            <button class="btn-add-unit" onclick="openModal()">+ إضافة وحدة جديدة</button>
        </div>
    </div>

    <div id="dashboardPage">
        <div class="sidebar">
            <h2 id="displayUser">المديرية العامة</h2>
            <ul class="sidebar-menu">
                <li onclick="showSection('stats')" id="menu-stats" class="active">الرئيسية (الإحصائيات)</li>
                <li onclick="alert('واجهة الإرسال قيد التطوير')">متابعة الإرسال</li>
                <li onclick="showSection('archive')" id="menu-archive">الأرشيف الوطني</li>
                <li style="background: #d32f2f; margin-top: 50px;" onclick="location.reload()">تسجيل الخروج</li>
            </ul>
        </div>

        <div class="main-content">
            <div id="statsContent">
                <div style="background: white; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                    <h2 style="margin:0; color: var(--dark-blue);">لوحة التحكم الوطنية</h2>
                    <div id="currentDate"></div>
                </div>
                <div class="stats-grid">
    <div class="stat-card">
        <h3>إجمالي التدخلات</h3>
        <div class="value">5,432</div>
    </div>
    
    <div class="stat-card">
        <h3>حوادث المرور</h3>
        <div class="value">1,120</div>
    </div>

    <div class="stat-card">
        <h3>الحرائق</h3>
        <div class="value">342</div>
    </div>

    <div class="stat-card" style="border-bottom-color: #2980b9;">
        <h3>الإسعاف والإجلاء</h3>
        <div class="value">2,850</div>
    </div>

    <div class="stat-card" style="border-bottom-color: #f39c12;">
        <h3>العمليات المختلفة</h3>
        <div class="value">1,120</div>
    </div>

    <div class="stat-card" style="border-bottom-color: #27ae60;">
        <h3>ولايات أرسلت</h3>
        <div class="value" id="sentCount">0 / 69</div>
    </div>
</div>
            </div>

            <div id="archiveSection" class="archive-container">
                <h2 style="color: var(--dark-blue); border-bottom: 2px solid var(--primary-red); padding-bottom: 10px;">الأرشيف الوطني للحصائل</h2>
                <div class="filter-bar">
                    <div style="flex:1">
                        <label>السنة</label>
                        <select id="yearFilter"><option>2026</option><option>2025</option><option>2024</option></select>
                    </div>
                    <div style="flex:1">
                        <label>الشهر</label>
                        <select id="monthFilter">
                            <option value="">-- كل الشهور --</option>
                            <option value="1">جانفي</option><option value="2">فيفري</option><option value="3">مارس</option>
                        </select>
                    </div>
                    <div style="flex:1">
                        <label>الأسبوع</label>
                        <select id="weekFilter">
                            <option value="">-- كامل الشهر --</option>
                            <option value="1">الأسبوع 1</option><option value="2">الأسبوع 2</option>
                        </select>
                    </div>
                    <button class="btn-login" style="margin:0; width: auto; padding: 10px 25px;" onclick="loadArchiveData()">عرض</button>
                </div>

                <div id="printArea">
                    <h3 id="reportTitle" style="text-align: center; color: var(--dark-blue); margin-bottom: 20px;">تقرير الحصيلة الدورية الرسمية</h3>
                    <table id="archiveTable">
                        <thead>
                            <tr><th>التاريخ</th><th>الولاية</th><th>حوادث مرور</th><th>حرائق</th><th>إجلاء صحي</th><th>أخرى</th><th>إجمالي</th></tr>
                        </thead>
                        <tbody id="archiveTableBody">
                            <tr><td>2026-02-18</td><td>الوادي</td><td>14</td><td>3</td><td>32</td><td>5</td><td>54</td></tr>
                            <tr><td>2026-02-17</td><td>أدرار</td><td>8</td><td>1</td><td>20</td><td>4</td><td>33</td></tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 25px;">
                    <button class="btn-export bg-excel" onclick="exportToExcel()">تصدير Excel</button>
                    <button class="btn-export bg-pdf" onclick="exportToPDF()">تحميل PDF</button>
                    <button class="btn-export bg-print" onclick="window.print()">طباعة</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-box">
            <h3 style="color: var(--primary-red); text-align: center;">إضافة وحدة جديدة</h3>
            <div class="form-group"><label>الولاية:</label><input type="text" id="modalWilayaName" disabled></div>
            <div class="form-group"><label>اسم الوحدة:</label><input type="text" id="newUnitName" placeholder="اسم الوحدة"></div>
            <div class="form-group"><label>كلمة المرور:</label><input type="text" id="newUnitPass" value="1111"></div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn-login" style="margin:0; background: var(--success-green);" onclick="confirmAddUnit()">حفظ</button>
                <button class="btn-login" style="margin:0; background: #6c757d;" onclick="closeModal()">إلغاء</button>
            </div>
        </div>
    </div>

    <script>
        let unitsData = { "المديرية العامة": [{ name: "مديرية الإحصائيات", pass: "1111" }] };
        const wilayas = ["أدرار", "الشلف", "الأغواط", "أم البواقي", "باتنة", "بجاية", "بسكرة", "بشار", "البليدة", "البويرة", "تمنراست", "تبسة", "تلمسان", "تيارت", "تيزي وزو", "الجزائر العاصمة", "الجلفة", "جيجل", "سطيف", "سعيدة", "سكيكدة", "سيدي بلعباس", "عنابة", "قالمة", "قسنطينة", "المدية", "مستغانم", "المسيلة", "معسكر", "ورقلة", "وهران", "البيض", "إليزي", "برج بوعريريج", "بومرداس", "الطارف", "تندوف", "تيسمسيلت", "الوادي", "خنشلة", "سوق أهراس", "تيبازة", "ميلة", "عين الدفلى", "الالنعامة", "عين تموشنت", "غرداية", "غليزان", "تيميمون", "برج باجي مختار", "أولاد جلال", "بني عباس", "عين صالح", "عين قزام", "تقرت", "جانت", "المغير", "المنيعة", "آفلو", "بريكة", "القنطرة", "بير العاتر", "العريشة", "قصر الشلالة", "عين وسارة", "مسعد", "قصر البخاري", "بوسعادة", "الأبيض سيدي الشيخ"];

        // تهيئة الولايات والوحدات
        const wSelect = document.getElementById('wilayaSelect');
        wilayas.forEach((w, i) => {
            let opt = document.createElement('option');
            opt.value = w; opt.text = `(${String(i+1).padStart(2,'0')}) ${w}`;
            wSelect.appendChild(opt);
            unitsData[w] = [{ name: `مديرية لولاية ${w}`, pass: "1111" }, { name: `الوحدة الرئيسية - ${w}`, pass: "1111" }];
        });

        function initUnits() {
            const unitS = document.getElementById('unitSelect');
            const selW = wSelect.value;
            unitS.innerHTML = '<option value="">-- اختر الوحدة --</option>';
            if (selW && unitsData[selW]) {
                unitsData[selW].forEach(u => {
                    let opt = document.createElement('option');
                    opt.value = u.name; opt.text = u.name; unitS.appendChild(opt);
                });
            }
        }

        // تسجيل الدخول
        function handleLogin() {
            const w = wSelect.value; const u = document.getElementById('unitSelect').value;
            const p = document.getElementById('passwordInput').value;
            const unitObj = unitsData[w]?.find(item => item.name === u);

            if (unitObj && unitObj.pass === p) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboardPage').style.display = 'block';
                document.getElementById('displayUser').innerText = u;
                document.getElementById('currentDate').innerText = new Date().toLocaleDateString('ar-DZ');
            } else { alert("بيانات الدخول خاطئة!"); }
        }

        // التبديل بين الأقسام
        function showSection(section) {
            document.getElementById('statsContent').style.display = (section === 'stats') ? 'block' : 'none';
            document.getElementById('archiveSection').style.display = (section === 'archive') ? 'block' : 'none';
            document.getElementById('menu-stats').classList.toggle('active', section === 'stats');
            document.getElementById('menu-archive').classList.toggle('active', section === 'archive');
        }

        // الأرشيف والتصدير
        function loadArchiveData() { alert("جاري جلب البيانات..."); }

        function exportToExcel() {
            const table = document.getElementById("archiveTable");
            const wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
            XLSX.writeFile(wb, "Hassila_Archive.xlsx");
        }

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            const canvas = await html2canvas(document.getElementById("printArea"));
            const imgData = canvas.toDataURL('image/png');
            doc.addImage(imgData, 'PNG', 20, 20, 550, 0);
            doc.save("Report.pdf");
        }

        // Modal functions
        function openModal() { if(!wSelect.value){alert("اختر الولاية أولاً"); return;} document.getElementById('modalWilayaName').value = wSelect.value; document.getElementById('modalOverlay').style.display = 'flex'; }
        function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
        function confirmAddUnit() {
            const w = wSelect.value; const n = document.getElementById('newUnitName').value; const p = document.getElementById('newUnitPass').value;
            if(n && p){ unitsData[w].push({name:n, pass:p}); initUnits(); closeModal(); alert("تمت الإضافة"); }
        }
    </script>
</body>
</html>
